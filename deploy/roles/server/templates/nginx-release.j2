server {  
  listen 443 ssl;

  server_name {{ host }};

  error_log /dev/null crit;

  access_log off;

  ssl_certificate         SSL_CERT;
  ssl_certificate_key     SSL_KEY;
  ssl_trusted_certificate SSL_CHAIN_CERT;

  add_header Strict-Transport-Security "max-age=63072000; includeSubdomains; preload";

  location = /{{ endpoint }}{
		if ($http_upgrade != "websocket") { 
			return 404;
		}
		proxy_redirect off;
		proxy_http_version 1.1;
		proxy_pass https://shadowsocks:9000/;
		proxy_set_header Upgrade $http_upgrade;
		proxy_set_header Connection "upgrade";
		proxy_set_header Host $http_host;
	}

	
	{% if not inited %}
		location /wg/ {
			proxy_redirect / /wg/;
			proxy_cookie_path / /wg/;
			proxy_http_version 1.1;
			proxy_set_header Upgrade $http_upgrade;
			proxy_set_header Connection "upgrade";
			proxy_set_header Host $http_host;
			proxy_pass http://wg:51821/;
		}
	{% endif %}

}
